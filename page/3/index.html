<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/default-avatar.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/highlight.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" title="图片来自网络">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/" title
        
        >首页</a>
      
        <a class="nav-item" href="/archives" title
        
        >归档</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main">
  
    <article id="post-okHttp3的源码分析" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/02/10/okHttp3%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">okHttp3的源码分析</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2023/02/10/okHttp3%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" class="article-date">
  <time datetime="2023-02-10T06:26:44.299Z" itemprop="datePublished">2023-02-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="okHttp3的源码分析"><a href="#okHttp3的源码分析" class="headerlink" title="okHttp3的源码分析"></a>okHttp3的源码分析</h1><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>同步与异步请求, 都在RealCall中实现, 分别描述</p>
<h2 id="异步请求"><a href="#异步请求" class="headerlink" title="异步请求"></a>异步请求</h2><p>​			入口代码如下</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">enqueue</span><span class="params">(responseCallback: <span class="type">Callback</span>)</span></span> &#123;</span><br><span class="line">  check(executed.compareAndSet(<span class="literal">false</span>, <span class="literal">true</span>)) &#123; <span class="string">&quot;Already Executed&quot;</span> &#125;</span><br><span class="line">  callStart()</span><br><span class="line">    </span><br><span class="line">  client.dispatcher.enqueue(AsyncCall(responseCallback))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>check(executed.compareAndSet(false, true)) { “Already Executed” } 检测是否执行过当前请求, executed is a AtomicBoolean</li>
<li>callStart()方法调用了eventListener.callStart(this), 实现callStart的监听回调</li>
<li>调用了enqueue()方法, 将传入的callback, 传入到AsyncCall中, 此类是RealCall的一个内部类, 实现了Runnable接口, 这里先查看enqueue方法</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">enqueue</span><span class="params">(call: <span class="type">AsyncCall</span>)</span></span> &#123;</span><br><span class="line">  synchronized(<span class="keyword">this</span>) &#123;</span><br><span class="line">    readyAsyncCalls.add(call)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!call.call.forWebSocket) &#123;</span><br><span class="line">      <span class="keyword">val</span> existingCall = findExistingCallWithHost(call.host)</span><br><span class="line">      <span class="keyword">if</span> (existingCall != <span class="literal">null</span>) call.reuseCallsPerHostFrom(existingCall)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  promoteAndExecute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>这里可以看到, 传入的AsyncCall进入了一个队列readyAsyncCalls, 这是已经准备好, 可以开始运行的请求队列</li>
<li>if代码块, 是对相同host的请求的复用</li>
<li>promoteAndExecute()是对call的执行, 查看此方法, 这里去除了非重点代码</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">promoteAndExecute</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.assertThreadDoesntHoldLock()</span><br><span class="line"> <span class="comment">//...  </span></span><br><span class="line">  <span class="keyword">val</span> executableCalls = mutableListOf&lt;AsyncCall&gt;()</span><br><span class="line">  synchronized(<span class="keyword">this</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> i = readyAsyncCalls.iterator()</span><br><span class="line">    <span class="keyword">while</span> (i.hasNext()) &#123;</span><br><span class="line">      <span class="keyword">val</span> asyncCall = i.next()</span><br><span class="line">      i.remove()</span><br><span class="line">      asyncCall.callsPerHost.incrementAndGet()</span><br><span class="line">      <span class="comment">//...  </span></span><br><span class="line">      executableCalls.add(asyncCall)</span><br><span class="line">      runningAsyncCalls.add(asyncCall)</span><br><span class="line">      <span class="comment">//...   </span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until executableCalls.size) &#123;</span><br><span class="line">    <span class="keyword">val</span> asyncCall = executableCalls[i]</span><br><span class="line">    asyncCall.executeOn(executorService)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> isRunning</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>主要思路是用迭代器遍历整个readyAsyncCalls队列, 不断取出, 并放入executableCalls列表和runningAsyncCalls队列</li>
<li>runningAsyncCalls用于记录正在运行的请求</li>
<li>executableCalls在下方for循环中调用了asyncCall.executeOn(executorService), 调用了线程池的execute方法, 间接执行之前传入的AsyncCall的run方法, run方法实现如下</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">  threadName(<span class="string">&quot;OkHttp <span class="subst">$&#123;redactedUrl()&#125;</span>&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> signalledCallback = <span class="literal">false</span></span><br><span class="line">    timeout.enter()</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">val</span> response = getResponseWithInterceptorChain()</span><br><span class="line">      signalledCallback = <span class="literal">true</span></span><br><span class="line">      responseCallback.onResponse(<span class="keyword">this</span><span class="symbol">@RealCall</span>, response)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">      <span class="keyword">if</span> (signalledCallback) &#123;</span><br><span class="line">        <span class="comment">// Do not signal the callback twice!</span></span><br><span class="line">        Platform.<span class="keyword">get</span>().log(<span class="string">&quot;Callback failure for <span class="subst">$&#123;toLoggableString()&#125;</span>&quot;</span>, Platform.INFO, e)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        responseCallback.onFailure(<span class="keyword">this</span><span class="symbol">@RealCall</span>, e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (t: Throwable) &#123;</span><br><span class="line">      cancel()</span><br><span class="line">      <span class="keyword">if</span> (!signalledCallback) &#123;</span><br><span class="line">        <span class="keyword">val</span> canceledException = IOException(<span class="string">&quot;canceled due to <span class="variable">$t</span>&quot;</span>)</span><br><span class="line">        canceledException.addSuppressed(t)</span><br><span class="line">        responseCallback.onFailure(<span class="keyword">this</span><span class="symbol">@RealCall</span>, canceledException)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> t</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      client.dispatcher.finished(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>执行了getResponseWithInterceptorChain方法获取response, 这里告一段落, 后面分析此方法</li>
</ol>
<h2 id="同步请求"><a href="#同步请求" class="headerlink" title="同步请求"></a>同步请求</h2><p>​			入口代码如下</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">execute</span><span class="params">()</span></span>: Response &#123;</span><br><span class="line">  check(executed.compareAndSet(<span class="literal">false</span>, <span class="literal">true</span>)) &#123; <span class="string">&quot;Already Executed&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">  timeout.enter()</span><br><span class="line">  callStart()</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    client.dispatcher.executed(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">return</span> getResponseWithInterceptorChain()</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    client.dispatcher.finished(<span class="keyword">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>check(executed.compareAndSet(false, true)) { “Already Executed” } 和异步请求同样的检测是否执行过</li>
<li>callStart()与异步请求同样的, 是请求开始的回调</li>
<li>client.dispatcher.executed(this), 实现如下, 同步请求是直接加入runningSyncCalls队列的</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Used by [Call.execute] to signal it is in-flight. */</span></span><br><span class="line"><span class="meta">@Synchronized</span> <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">executed</span><span class="params">(call: <span class="type">RealCall</span>)</span></span> &#123;</span><br><span class="line">  runningSyncCalls.add(call)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>最后同样执行了getResponseWithInterceptorChain方法返回response, 与异步请求统一起来, 下面查看此方法</li>
</ol>
<h2 id="getResponseWithInterceptorChain的分析"><a href="#getResponseWithInterceptorChain的分析" class="headerlink" title="getResponseWithInterceptorChain的分析"></a>getResponseWithInterceptorChain的分析</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">getResponseWithInterceptorChain</span><span class="params">()</span></span>: Response &#123;</span><br><span class="line">  <span class="comment">// Build a full stack of interceptors.</span></span><br><span class="line">  <span class="keyword">val</span> interceptors = mutableListOf&lt;Interceptor&gt;()</span><br><span class="line">  interceptors += client.interceptors</span><br><span class="line">  interceptors += RetryAndFollowUpInterceptor(client)</span><br><span class="line">  interceptors += BridgeInterceptor(client.cookieJar)</span><br><span class="line">  interceptors += CacheInterceptor(client.cache)</span><br><span class="line">  interceptors += ConnectInterceptor</span><br><span class="line">  <span class="keyword">if</span> (!forWebSocket) &#123;</span><br><span class="line">    interceptors += client.networkInterceptors</span><br><span class="line">  &#125;</span><br><span class="line">  interceptors += CallServerInterceptor(forWebSocket)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> chain = RealInterceptorChain(</span><br><span class="line">      call = <span class="keyword">this</span>,</span><br><span class="line">      interceptors = interceptors,</span><br><span class="line">      index = <span class="number">0</span>,</span><br><span class="line">      exchange = <span class="literal">null</span>,</span><br><span class="line">      request = originalRequest,</span><br><span class="line">      connectTimeoutMillis = client.connectTimeoutMillis,</span><br><span class="line">      readTimeoutMillis = client.readTimeoutMillis,</span><br><span class="line">      writeTimeoutMillis = client.writeTimeoutMillis</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> calledNoMoreExchanges = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> response = chain.proceed(originalRequest)</span><br><span class="line">    <span class="keyword">if</span> (isCanceled()) &#123;</span><br><span class="line">      response.closeQuietly()</span><br><span class="line">      <span class="keyword">throw</span> IOException(<span class="string">&quot;Canceled&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">    calledNoMoreExchanges = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">throw</span> noMoreExchanges(e) <span class="keyword">as</span> Throwable</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!calledNoMoreExchanges) &#123;</span><br><span class="line">      noMoreExchanges(<span class="literal">null</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>构建了一个Interceptor(拦截器)的ArrayList</li>
<li>依次添加各种Interceptor</li>
<li>生成一个RealInterceptorChain</li>
<li>执行了RealInterceptorChain.proceed方法, 来获取response</li>
<li>这里是一个责任链模式的典型使用, 下面分析责任链中每一个对象的职责</li>
</ol>
<h2 id="ConnectInterceptor分析"><a href="#ConnectInterceptor分析" class="headerlink" title="ConnectInterceptor分析"></a>ConnectInterceptor分析</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> ConnectInterceptor : Interceptor &#123;</span><br><span class="line">  <span class="meta">@Throws(IOException::class)</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">intercept</span><span class="params">(chain: <span class="type">Interceptor</span>.<span class="type">Chain</span>)</span></span>: Response &#123;</span><br><span class="line">    <span class="keyword">val</span> realChain = chain <span class="keyword">as</span> RealInterceptorChain</span><br><span class="line">    <span class="keyword">val</span> exchange = realChain.call.initExchange(chain)</span><br><span class="line">    <span class="keyword">val</span> connectedChain = realChain.copy(exchange = exchange)</span><br><span class="line">    <span class="keyword">return</span> connectedChain.proceed(realChain.request)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>initExchange()方法会调用exchangeFinder.find(client, chain), 进而调用以下方法</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(SocketException::class)</span></span><br><span class="line"><span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">newCodec</span><span class="params">(client: <span class="type">OkHttpClient</span>, chain: <span class="type">RealInterceptorChain</span>)</span></span>: ExchangeCodec &#123;</span><br><span class="line">  <span class="keyword">val</span> socket = <span class="keyword">this</span>.socket!!</span><br><span class="line">  <span class="keyword">val</span> source = <span class="keyword">this</span>.source!!</span><br><span class="line">  <span class="keyword">val</span> sink = <span class="keyword">this</span>.sink!!</span><br><span class="line">  <span class="keyword">val</span> http2Connection = <span class="keyword">this</span>.http2Connection</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">if</span> (http2Connection != <span class="literal">null</span>) &#123;</span><br><span class="line">    Http2ExchangeCodec(client, <span class="keyword">this</span>, chain, http2Connection)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    socket.soTimeout = chain.readTimeoutMillis()</span><br><span class="line">    source.timeout().timeout(chain.readTimeoutMillis.toLong(), MILLISECONDS)</span><br><span class="line">    sink.timeout().timeout(chain.writeTimeoutMillis.toLong(), MILLISECONDS)</span><br><span class="line">    Http1ExchangeCodec(client, <span class="keyword">this</span>, source, sink)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>这里可以看到,  在不同情况下, 会建立Http2ExchangeCodec 或 Http1ExchangeCodec的对象</li>
<li>注意这里的source和sink, 这是数据传输的buffer, 在建立连接后, sink用于数据发送, source用于数据获取</li>
<li>对于Http1ExchangeCodec, 是直接传入了source 和 sink</li>
<li>对于Http2ExchangeCodec, 传入了http2Connection, 此对象建立过程如下</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">startHttp2</span><span class="params">(pingIntervalMillis: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">val</span> socket = <span class="keyword">this</span>.socket!!</span><br><span class="line">  <span class="keyword">val</span> source = <span class="keyword">this</span>.source!!</span><br><span class="line">  <span class="keyword">val</span> sink = <span class="keyword">this</span>.sink!!</span><br><span class="line">  socket.soTimeout = <span class="number">0</span> <span class="comment">// HTTP/2 connection timeouts are set per-stream.</span></span><br><span class="line">  <span class="keyword">val</span> http2Connection = Http2Connection.Builder(client = <span class="literal">true</span>, taskRunner = TaskRunner.INSTANCE)</span><br><span class="line">      .socket(socket, route.address.url.host, source, sink)</span><br><span class="line">      .listener(<span class="keyword">this</span>)</span><br><span class="line">      .pingIntervalMillis(pingIntervalMillis)</span><br><span class="line">      .build()</span><br><span class="line">  <span class="keyword">this</span>.http2Connection = http2Connection</span><br><span class="line">  <span class="keyword">this</span>.allocationLimit = Http2Connection.DEFAULT_SETTINGS.getMaxConcurrentStreams()</span><br><span class="line">  http2Connection.start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>可以看出http2Connection对象的建立过程中也是传入了source 和 sink</li>
<li>而source 和 sink在connectSocket方法中, 是被rawSocket的source 和 sink的buffer赋值的</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">connectSocket</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  connectTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  readTimeout: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  call: <span class="type">Call</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  eventListener: <span class="type">EventListener</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">  <span class="keyword">val</span> proxy = route.proxy</span><br><span class="line">  <span class="keyword">val</span> address = route.address</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> rawSocket = <span class="keyword">when</span> (proxy.type()) &#123;</span><br><span class="line">    Proxy.Type.DIRECT, Proxy.Type.HTTP -&gt; address.socketFactory.createSocket()!!</span><br><span class="line">    <span class="keyword">else</span> -&gt; Socket(proxy)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.rawSocket = rawSocket</span><br><span class="line"></span><br><span class="line">  eventListener.connectStart(call, route.socketAddress, proxy)</span><br><span class="line">  rawSocket.soTimeout = readTimeout</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Platform.<span class="keyword">get</span>().connectSocket(rawSocket, route.socketAddress, connectTimeout)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e: ConnectException) &#123;</span><br><span class="line">    <span class="keyword">throw</span> ConnectException(<span class="string">&quot;Failed to connect to <span class="subst">$&#123;route.socketAddress&#125;</span>&quot;</span>).apply &#123;</span><br><span class="line">      initCause(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The following try/catch block is a pseudo hacky way to get around a crash on Android 7.0</span></span><br><span class="line">  <span class="comment">// More details:</span></span><br><span class="line">  <span class="comment">// https://github.com/square/okhttp/issues/3245</span></span><br><span class="line">  <span class="comment">// https://android-review.googlesource.com/#/c/271775/</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    source = rawSocket.source().buffer()</span><br><span class="line">    sink = rawSocket.sink().buffer()</span><br><span class="line">  &#125; <span class="keyword">catch</span> (npe: NullPointerException) &#123;</span><br><span class="line">    <span class="keyword">if</span> (npe.message == NPE_THROW_WITH_NULL) &#123;</span><br><span class="line">      <span class="keyword">throw</span> IOException(npe)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>因此, 到这里Http2ExchangeCodec和Http1ExchangeCodec都持有了source 和 sink两个对象</li>
</ol>
<h2 id="CallServerInterceptor分析"><a href="#CallServerInterceptor分析" class="headerlink" title="CallServerInterceptor分析"></a>CallServerInterceptor分析</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** This is the last interceptor in the chain. It makes a network call to the server. */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CallServerInterceptor</span>(<span class="keyword">private</span> <span class="keyword">val</span> forWebSocket: <span class="built_in">Boolean</span>) : Interceptor &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">intercept</span><span class="params">(chain: <span class="type">Interceptor</span>.<span class="type">Chain</span>)</span></span>: Response &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        exchange.writeRequestHeaders(request)</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        requestBody.writeTo(bufferedRequestBody)</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        exchange.responseHeadersStart()</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">var</span> response = responseBuilder</span><br><span class="line">            .request(request)</span><br><span class="line">            .handshake(exchange.connection.handshake())</span><br><span class="line">            .sentRequestAtMillis(sentRequestMillis)</span><br><span class="line">            .receivedResponseAtMillis(System.currentTimeMillis())</span><br><span class="line">            .build()</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        response.newBuilder()</span><br><span class="line">            .body(exchange.openResponseBody(response))</span><br><span class="line">            .build()</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>CallServerInterceptor是责任链的最后一个拦截器, 实现了请求的发送和数据的获取, 只保留了下面要分析的代码</li>
<li>exchange.writeRequestHeaders(request)发送headers</li>
<li>requestBody.writeTo(bufferedRequestBody)发送body</li>
<li>exchange.responseHeadersStart()在获取返回数据的headers</li>
<li>exchange.openResponseBody(response)在获取返回数据的body部分</li>
<li>这里的发送或者读取都是通过source 和 sink对象实现的</li>
<li>查看openResponseBody的实现</li>
</ol>
<h2 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> Buffer.<span class="title">commonWrite</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        source: <span class="type">ByteArray</span>, offset: <span class="type">Int</span>, byteCount: <span class="type">Int</span>)</span></span>: Buffer &#123;</span><br><span class="line">    <span class="keyword">var</span> offset = offset</span><br><span class="line">    checkOffsetAndCount(source.size.toLong(), offset.toLong(), byteCount.toLong())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> limit = offset + byteCount</span><br><span class="line">    <span class="keyword">while</span> (offset &lt; limit) &#123;</span><br><span class="line">        <span class="comment">//这里获取了一个列表, 因此数据是得到保存的</span></span><br><span class="line">        <span class="keyword">val</span> tail = writableSegment(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> toCopy = minOf(limit - offset, Segment.SIZE - tail.limit)</span><br><span class="line">        source.copyInto(destination = tail.<span class="keyword">data</span>, destinationOffset = tail.limit,</span><br><span class="line">                startIndex = offset, endIndex = offset + toCopy)</span><br><span class="line"></span><br><span class="line">        offset += toCopy</span><br><span class="line">        tail.limit += toCopy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    size += byteCount.toLong()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\anjiaheng01\AppData\Roaming\Typora\typora-user-images\image-20221118170518051.png" alt="okio中有趣的代码"></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-HashMap" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/02/10/HashMap/">HashMap</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2023/02/10/HashMap/" class="article-date">
  <time datetime="2023-02-10T06:26:44.298Z" itemprop="datePublished">2023-02-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h1><h2 id="关于HashMap容量确定方法-tableSizeFor"><a href="#关于HashMap容量确定方法-tableSizeFor" class="headerlink" title="关于HashMap容量确定方法, tableSizeFor()"></a>关于HashMap容量确定方法, tableSizeFor()</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a power of two size for the given target capacity.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">tableSizeFor</span><span class="params">(<span class="type">int</span> cap)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cap - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ol>
<li><p>不断对n执行右移操作, 并进行或运算, 最后保证了n的二进制位上从左往右第一个1右侧全部为1</p>
</li>
<li><p>+1操作, 实现了进位, 获得了大于等于给定容量的最小的整2次幂数字</p>
</li>
<li><p>通过此方式确保了capacity is pow-of-two number</p>
</li>
<li><p>保证容量是2的整数次幂的原因, 在于hash运算时,使用&amp;运算来保证index不会越界</p>
</li>
</ol>
<h2 id="Map新增键值对的方法-putVal"><a href="#Map新增键值对的方法-putVal" class="headerlink" title="Map新增键值对的方法, putVal()"></a>Map新增键值对的方法, putVal()</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.put and related methods.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to put</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> onlyIfAbsent if true, don&#x27;t change existing value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">               <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// 2</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="comment">// 3</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="comment">// 5</span></span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ol>
<li>注意上面tab下标的确定方式 i &#x3D; (n - 1) &amp; hash, 采用了与运算, 而不是取模, 目的是优化计算时间</li>
<li>如果k和v都一样, 不需要其他操作, 给e赋值, 返回时返回此node即可</li>
<li>如果不一样, 考虑两种情况, 第一种是p为树的节点, 使用putTreeVal方法存入Node即可</li>
<li>第二种情况, p是链表的结点, 通过循环新建一个节点, 为p的next指针赋值即可</li>
<li>此处为回调, 在LinkedHashMap中有实现</li>
</ol>
<h2 id="HashMap的resize方法"><a href="#HashMap的resize方法" class="headerlink" title="HashMap的resize方法"></a>HashMap的resize方法</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Initializes or doubles table size.  If null, allocates in</span></span><br><span class="line"><span class="comment"> * accord with initial capacity target held in field threshold.</span></span><br><span class="line"><span class="comment"> * Otherwise, because we are using power-of-two expansion, the</span></span><br><span class="line"><span class="comment"> * elements from each bin must either stay at same index, or move</span></span><br><span class="line"><span class="comment"> * with a power of two offset in the new table.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the table</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldCap</span> <span class="operator">=</span> (oldTab == <span class="literal">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">oldThr</span> <span class="operator">=</span> threshold;</span><br><span class="line">    <span class="type">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (<span class="type">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">float</span> <span class="variable">ft</span> <span class="operator">=</span> (<span class="type">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="type">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="type">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">        <span class="comment">// 1</span></span><br><span class="line">    &#125;</span><br><span class="line">    threshold = newThr;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                oldTab[j] = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="literal">null</span>)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="comment">// 2</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="built_in">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="comment">// 3</span></span><br><span class="line">                <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">// 4</span></span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="literal">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 5</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ol>
<li>这里证实了threshold &#x3D; capacity * loadFactor</li>
<li>这里是对于没有hash冲突的节点重新计算index值处理</li>
<li>对于红黑树的结点执行特殊的操作</li>
<li>这里是通过判断hash与原capacity的&amp;运算, 实现了对扩容后index变化的节点和不变化的节点进行分类</li>
<li>对于类节点分别置于新的HashMap的table中</li>
</ol>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Android面试题单" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/02/10/Android%E9%9D%A2%E8%AF%95%E9%A2%98%E5%8D%95/">Android面试题单</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2023/02/10/Android%E9%9D%A2%E8%AF%95%E9%A2%98%E5%8D%95/" class="article-date">
  <time datetime="2023-02-10T06:26:44.295Z" itemprop="datePublished">2023-02-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="Android面试题单"><a href="#Android面试题单" class="headerlink" title="Android面试题单"></a>Android面试题单</h1><ul>
<li>Service 与 IntentService 的区别。<a target="_blank" rel="noopener" href="https://stackoverflow.com/a/15772151/5153275">Link</a></li>
<li>Android 应用的结构是什么？</li>
<li>Android 应用中如何保存数据。</li>
<li>如何在 Android 应用中执行耗时操作。</li>
<li>两个 Fragment 之间如何通信。</li>
<li>阐述一下 Android 的通知系统。</li>
<li>两个不同的 app 之间如何交互。</li>
<li>什么是 Fragment？</li>
<li>为什么建议只使用默认的构造方法来创建 Fragment？<a target="_blank" rel="noopener" href="https://stackoverflow.com/a/16042750/2809326">Link</a></li>
<li>为什么 Bundle 被用来传递数据，为什么不能使用简单的 Map 数据结构？</li>
<li>阐述一下 Fragment 的生命周期。<a target="_blank" rel="noopener" href="https://www.techsfo.com/blog/wp-content/uploads/2014/08/complete_android_fragment_lifecycle.png">Link</a></li>
<li>如何理解 Android 的 Dialog ？</li>
<li>解释下 Android 的 View 。</li>
<li>你能创建自定义 View 吗？具体是如何创建的？</li>
<li>什么是 ViewGroup ，它与 View 的区别在哪里？</li>
<li>Fragment 和 Activity 有什么区别？它们之间又有什么关系？</li>
<li>谈谈 Serializable 接口和 Parcelable 接口的区别。在 Android 中最好使用哪种接口？<ul>
<li>Serializable使用IO读写存储在硬盘上。序列化过程使用了反射技术，并且期间产生临时对象，优点代码少，在将对象序列化到存储设置中或将对象序列化后通过网络传输时建议选择Serializable。</li>
<li>Parcelable是直接在内存中读写，我们知道内存的读写速度肯定优于硬盘读写速度，所以Parcelable序列化方式性能上要优于Serializable方式很多。所以Android应用程序在内存间数据传输时推荐使用Parcelable，如activity间传输数据和AIDL数据传递。大多数情况下使用Serializable也是没什么问题的，但是针对Android应用程序在内存间数据传输还是建议大家使用Parcelable方式实现序列化，毕竟性能好很多，其实也没多麻烦。</li>
<li>Parcelable也不是不可以在网络中传输，只不过实现和操作过程过于麻烦并且为了防止android版本不同而导致Parcelable可能不同的情况，因此在序列化到存储设备或者网络传输方面还是尽量选择Serializable接口。</li>
</ul>
</li>
<li>Activity 的启动模式有哪些？<a target="_blank" rel="noopener" href="https://blog.mindorks.com/android-activity-launchmode-explained-cbc6cf996802">Link</a></li>
<li>解释一下 Android 中的 Intent 。<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6578051/what-is-an-intent-in-android">Link</a></li>
<li>什么是隐式 Intent ？</li>
<li>什么是显式 Intent ？</li>
<li>解释一下 AsyncTask 。</li>
<li>如何理解 Android 中的广播。<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5296987/what-is-broadcastreceiver-and-when-we-use-it">Link</a></li>
<li>如何理解 Android 的 LocalBroadcastManager 。<a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/support/v4/content/LocalBroadcastManager.html">Link</a></li>
<li>什么是 JobScheduler ？<a target="_blank" rel="noopener" href="http://www.vogella.com/tutorials/AndroidTaskScheduling/article.html">Link</a></li>
<li>什么是 DDMS ？你可以用它来做什么？</li>
<li>解释一下什么是 support libary ，以及为什么要引入 support library ？<a target="_blank" rel="noopener" href="http://martiancraft.com/blog/2015/06/android-support-library/">Link</a></li>
<li>如何理解 Android 中的 ContentProvider 。它通常用来干什么？</li>
<li>什么是 Data Binding ？<a target="_blank" rel="noopener" href="https://developer.android.com/topic/libraries/data-binding/index.html">Link</a></li>
<li>Android 的核心组件具体都有什么？<a target="_blank" rel="noopener" href="https://developer.android.com/topic/libraries/architecture/index.html">Link</a></li>
<li>什么是 ADB ？</li>
<li>什么是 ANR ？如何避免发生 ANR ？</li>
<li>AndroidManifest.xml 是什么？</li>
<li>解释一下 broadcast 和 intent 在 app 内传递消息的工作流程。</li>
<li>当 Bitmap 占用较多内存时，你是怎么处理的？</li>
<li>Android 应用有哪些不同的存储数据的方式？</li>
<li>什么是 Dalvik 虚拟机？</li>
<li>AsyncTask 的生命周期和(它所属的) Activity 的生命周期有什么关系？这种关系可能会导致什么样的问题？ 如何避免这些问题发生？</li>
<li>Intent filter 是用来做什么的？</li>
<li>什么是 Sticky Intent？<a target="_blank" rel="noopener" href="http://www.androidinterview.com/what-is-a-sticky-intent/">Link</a></li>
<li>什么是 AIDL ？列举一下通过 AIDL 创建被绑定的服务（bounded service）的步骤。</li>
<li>Android 的权限有多少个不同的保护等级？</li>
<li>在转屏时你如何保存 Activity 的状态？<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3915952/how-to-save-state-during-orientation-change-in-android-if-the-state-is-made-of-m">Link</a></li>
<li>相对布局和线性布局的区别。</li>
<li>如何实现 XML 命名空间？</li>
<li>View.GONE 和 View.INVISIBLE 之间的区别。</li>
<li>Bitmap 和 .9（nine-patch）图片之间有什么区别？</li>
<li>谈谈位图池。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/how-to-use-bitmap-pool-in-android-56c71a55533c">Link</a></li>
<li>在 Android 中如何避免内存泄漏？</li>
<li>Android 桌面的小部件是什么？</li>
<li>什么是 AAPT ？</li>
<li>你是如何在 Android 应用程序中发现内存泄漏的？</li>
<li>你如何排查应用崩溃的原因？</li>
<li>为什么你应该避免在主线程上运行非用户界面相关的代码？</li>
<li>你是如何适配不同分辨率的手机的？</li>
<li>如何理解 Doze 模式。如何理解应用程序待机模式（App Standby）。</li>
<li>在 Android 中，你可以使用什么来进行后台操作?</li>
<li>什么是 ORM ？它是如何工作的？</li>
<li>什么是 Loader ？</li>
<li>什么是 NDK ，为什么它是有用的？</li>
<li>如何理解严格模式（StrictMode）。 <a target="_blank" rel="noopener" href="https://blog.mindorks.com/use-strictmode-to-find-things-you-did-by-accident-in-android-development-4cf0e7c8d997">Link</a></li>
<li>什么是 Lint ？它的用途是什么？</li>
<li>什么是 SurfaceView ？</li>
<li>ListView 和 RecyclerView 有什么区别？</li>
<li>什么是 ViewHolder 模式？为什么我们应该使用它？</li>
<li>什么是 PendingIntent ？</li>
<li>你能手动调用垃圾回收吗？</li>
<li>周期地更新页面的最好方式是什么？</li>
<li>有哪些类型的广播？</li>
<li>你开发过组件吗？请描述一下。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/android-widgets-ad3d166458d3">Link</a></li>
<li>如何理解上下文（Context）。怎么使用它？<a target="_blank" rel="noopener" href="https://medium.com/p/understanding-context-in-android-application-330913e32514">Link</a></li>
<li>你知道什么是视图树(View Tree)吗？怎样优化它的深度？</li>
<li>onTrimMemory() 方法是什么？</li>
<li>Android 应用可以使用多进程吗？怎样使用？</li>
<li>内存溢出（OutOfMemory）是怎么发生的？</li>
<li>文本样式接口（Spannable）是什么？</li>
<li>什么是过度绘制（overdraw）？</li>
<li>什么是渲染脚本（renderscript）？<a target="_blank" rel="noopener" href="https://blog.mindorks.com/comparing-android-ndk-and-renderscript-1a718c01f6fe">Link</a></li>
<li>Dalvik 虚拟机模式和 ART（Android Runtime）虚拟机模式的区别。</li>
<li>FlatBuffers 和 JSON 的区别。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/why-consider-flatbuffer-over-json-2e4aa8d4ed07">Link</a></li>
<li>谈谈 Android 的注解。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/creating-custom-annotations-in-android-a855c5b43ed9">Link1</a>, <a target="_blank" rel="noopener" href="https://blog.mindorks.com/improve-your-android-coding-through-annotations-26b3273c137a">Link2</a></li>
<li>描述一下约束布局（Constraint Layout）。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/using-constraint-layout-in-android-531e68019cd">Link</a></li>
<li>阐述一下 Android 中的 HashMap , ArrayMap 和 SparseArray 。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/android-app-optimization-using-arraymap-and-sparsearray-f2b4e2e3dc47">Link</a></li>
<li>阐述一下 Looper, Handler 和 HandlerThread 。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/android-core-looper-handler-and-handlerthread-bd54d69fe91a">Link</a></li>
<li>如何降低 Android 应用的耗电量？<a target="_blank" rel="noopener" href="https://blog.mindorks.com/battery-optimization-for-android-apps-f4ef6170ff70">Link</a></li>
<li>SnapHelper 是什么？<a target="_blank" rel="noopener" href="https://blog.mindorks.com/using-snaphelper-in-recyclerview-fc616b6833e8">Link</a></li>
<li>在 Android 中怎么处理多点触控？<a target="_blank" rel="noopener" href="https://arjun-sna.github.io/android/2016/07/20/multi-touch-android/">link</a></li>
</ul>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><ul>
<li>请介绍一下你做的上一个 App 的架构。</li>
<li>请介绍一下 MVP。 <a target="_blank" rel="noopener" href="https://blog.mindorks.com/essential-guide-for-designing-your-android-app-architecture-mvp-part-1-74efaf1cda40">Link</a></li>
<li>Presenter 是什么？</li>
<li>什么是模型？</li>
<li>请介绍一下 MVC。</li>
<li>Controller 是什么？</li>
<li>请介绍一下 MVVM。 <a target="_blank" rel="noopener" href="https://github.com/MindorksOpenSource/android-mvvm-architecture">Link</a></li>
<li>谈谈你对代码整洁之道（clean code）的理解。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/every-programmer-should-read-this-book-6755dedec78d">Link</a></li>
</ul>
<h3 id="设计问题"><a href="#设计问题" class="headerlink" title="设计问题"></a>设计问题</h3><ul>
<li>请设计 Uber App。</li>
<li>请设计 Facebook App。</li>
<li>请设计 Facebook Near-By Friends App。</li>
<li>请设计 WhatsApp。</li>
<li>请设计 SnapChat。</li>
<li>基于地理位置 App 的设计问题。</li>
</ul>
<h3 id="工具和技能"><a href="#工具和技能" class="headerlink" title="工具和技能"></a>工具和技能</h3><ul>
<li>Git. <a target="_blank" rel="noopener" href="https://github.com/git-tips/tips">Link</a></li>
<li>RxJava. <a target="_blank" rel="noopener" href="https://blog.mindorks.com/a-complete-guide-to-learn-rxjava-b55c0cea3631">Link</a></li>
<li>Dagger 2. <a target="_blank" rel="noopener" href="https://medium.com/p/a-complete-guide-to-learn-dagger-2-b4c7a570d99c">Link</a></li>
<li>Android 开发实用工具。 <a target="_blank" rel="noopener" href="https://blog.mindorks.com/android-development-useful-tools-fd73283e82e3">Link</a></li>
<li>Firebase. <a target="_blank" rel="noopener" href="https://firebase.google.com/">Link</a></li>
</ul>
<h3 id="Android-测试驱动开发"><a href="#Android-测试驱动开发" class="headerlink" title="Android 测试驱动开发"></a>Android 测试驱动开发</h3><ul>
<li>Espresso 是什么？ <a target="_blank" rel="noopener" href="https://developer.android.com/training/testing/ui-testing/espresso-testing.html">Link</a></li>
<li>Robolectric 是什么？ <a target="_blank" rel="noopener" href="http://robolectric.org/">Link</a></li>
<li>UI-Automator 是什么？ <a target="_blank" rel="noopener" href="https://developer.android.com/training/testing/ui-testing/uiautomator-testing.html">Link</a></li>
<li>请解释一下单元测试。</li>
<li>请解释一下设备化测试。</li>
<li>你是否做过单元测试或者自动测试？</li>
<li>为什么要使用 Mockito？ <a target="_blank" rel="noopener" href="http://site.mockito.org/">Link</a></li>
<li>请描述一下 JUnit 测试。</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li>描述一下 REST APIs 如何工作 ？</li>
<li>描述一下 SQLite 。</li>
<li>描述一下 数据库 。</li>
<li>项目管理工具 - trello ，basecamp ，kanban ，jira ，asana 。</li>
<li>关于构建系统 - gradle , ant , buck 。</li>
<li>APK 逆向工程 。</li>
<li>混淆器用于什么 ？</li>
<li>什么是混淆？ 用于什么？ 如何压缩 ？</li>
<li>如何构建你的发布版本的 APP ？</li>
<li>如何面向特定用户群体更新应用程序版本 ？</li>
<li>可以识别卸载我们的应用程序的用户吗 ？</li>
<li>缩小 APK 的体积 。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/how-to-reduce-apk-size-in-android-2f3713d2d662">Link</a></li>
<li>Android 开发最佳实践 。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/android-development-best-practices-83c94b027fd3">Link</a></li>
<li>Android 代码风格和指南 。<a target="_blank" rel="noopener" href="https://blog.mindorks.com/android-code-style-and-guidelines-d5f80453d5c7">Link</a></li>
<li>你尝试使用过 Kotlin 吗 ？<a target="_blank" rel="noopener" href="https://blog.mindorks.com/why-you-must-try-kotlin-for-android-development-e14d00c8084b">Link</a></li>
<li>开发 Android 应用程序时应该连续测量哪些指标 ？<a target="_blank" rel="noopener" href="https://blog.mindorks.com/android-app-performance-metrics-a1176334186e">Link</a></li>
</ul>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Android Studio 使用" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/02/10/Android%20Studio%20%E4%BD%BF%E7%94%A8/">Android Studio 使用</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2023/02/10/Android%20Studio%20%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2023-02-10T06:26:44.293Z" itemprop="datePublished">2023-02-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="Android-Studio-使用"><a href="#Android-Studio-使用" class="headerlink" title="Android Studio 使用"></a>Android Studio 使用</h1><h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><ul>
<li>BreakPoint :  断点 AS的BreakPoint是从这里开始停止运行, 需要点击Resume按钮才能继续运行</li>
<li>Resume Program:  进入到下一个BreakPoint</li>
<li>Pause Program:  停在当前APP正在执行的代码行</li>
<li>View BreakPoints:  查看手动添加的BreakPoint( 方便寻找断点) </li>
<li>Mute BreakPoints:  忽略BreakPoints, 即使之失效</li>
<li>Step Over:  执行下一行</li>
<li>Step Into:  进入当前方法</li>
<li>Step Out:  退出当前函数栈帧</li>
</ul>
<h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ul>
<li>alt + ← (或→) 切换弹出</li>
</ul>
<h2 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h2><ul>
<li>tab窗口可以pin住, tab上右键</li>
<li>tab窗口可以分成两列, 对照使用, tab上右键</li>
</ul>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-795. 区间子数组个数" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/02/10/795.%20%E5%8C%BA%E9%97%B4%E5%AD%90%E6%95%B0%E7%BB%84%E4%B8%AA%E6%95%B0/">795. 区间子数组个数</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2023/02/10/795.%20%E5%8C%BA%E9%97%B4%E5%AD%90%E6%95%B0%E7%BB%84%E4%B8%AA%E6%95%B0/" class="article-date">
  <time datetime="2023-02-10T06:26:44.291Z" itemprop="datePublished">2023-02-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="795-区间子数组个数"><a href="#795-区间子数组个数" class="headerlink" title="795. 区间子数组个数"></a>795. 区间子数组个数</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><blockquote>
<p>给你一个整数数组 nums 和两个整数：left 及 right 。找出 nums 中连续、非空且其中最大元素在范围 [left, right] 内的子数组，并返回满足条件的子数组的个数。</p>
<p>生成的测试用例保证结果符合 32-bit 整数范围。</p>
<p>示例 1：</p>
<p>输入：nums &#x3D; [2,1,4,3], left &#x3D; 2, right &#x3D; 3<br>输出：3<br>解释：满足条件的三个子数组：[2], [2, 1], [3]<br>示例 2：</p>
<p>输入：nums &#x3D; [2,9,2,5,6], left &#x3D; 2, right &#x3D; 8<br>输出：7</p>
<p>提示：</p>
<p>1 &lt;&#x3D; nums.length &lt;&#x3D;$10^5$<br>0 &lt;&#x3D; nums[i] &lt;&#x3D; $10^9$<br>0 &lt;&#x3D; left &lt;&#x3D; right &lt;&#x3D; $10^5$<br>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/number-of-subarrays-with-bounded-maximum">https://leetcode.cn/problems/number-of-subarrays-with-bounded-maximum</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
</blockquote>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ul>
<li><p>复杂度分析: $10^5$, 应为O( N )或者O( $log_N$ )</p>
</li>
<li><p>递推解决, 对于f[ i ], 应从f[ i - 1 ]推导而来</p>
</li>
<li><p>分类讨论</p>
<ul>
<li>当nums[ i ] 大于right时, nums[ i ]对于最终ans没有贡献 </li>
<li>当nums[ i ] 小于left时, nums[ i ]的贡献, 应为:上一个在区间[left, right]内的数, 所在的符合要求的连续子数组的个数 + 1</li>
<li>当nums[ i ] 在区间[left, right]内时, nums[ i ]的贡献, 应为: 当前位置i所在的, 符合要求的连续子数组的个数</li>
</ul>
</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by anjiaheng01 on 2022/11/24.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> num[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">numSubarrayBoundedMax</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;nums, <span class="type">int</span> left, <span class="type">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> f[<span class="number">100000</span> + <span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> lastMaxPos = <span class="number">-1</span>;</span><br><span class="line">    <span class="type">int</span> lastVPos = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (nums[<span class="number">0</span>] &lt;= right &amp;&amp; nums[<span class="number">0</span>] &gt;= left) &#123;</span><br><span class="line">        f[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        lastVPos = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nums[<span class="number">0</span>] &gt; right) &#123;</span><br><span class="line">        lastMaxPos = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; l; i++) &#123;</span><br><span class="line">        f[i] = f[i - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (nums[i] &gt; right) &#123;</span><br><span class="line">            lastMaxPos = i;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[i] &lt; left) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lastVPos - lastMaxPos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (lastMaxPos == <span class="number">-1</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (lastVPos != <span class="number">-1</span>)</span><br><span class="line">                        f[i] = f[i - <span class="number">1</span>] + lastVPos + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lastVPos != <span class="number">-1</span>)</span><br><span class="line">                    f[i] = f[i - <span class="number">1</span>] + lastVPos - lastMaxPos;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            lastVPos = i;</span><br><span class="line">            <span class="keyword">if</span> (i - lastMaxPos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (lastMaxPos == <span class="number">-1</span>)</span><br><span class="line">                    f[i] = f[i - <span class="number">1</span>] + i + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    f[i] = f[i - <span class="number">1</span>] + i - lastMaxPos;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> f[l - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; v&#123;&#125;;</span><br><span class="line">    v.<span class="built_in">insert</span>(v.<span class="built_in">end</span>(), &#123;<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>&#125;);</span><br><span class="line">    cout &lt;&lt; <span class="built_in">numSubarrayBoundedMax</span>(v, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>对于代码, 可以优化, 但是我现在急着下班..</p>
<p>比如, f数组是冗余的, 可以参照, 01背包的滚动数组</p>
<p>对于, 小于left和在[left, right]范围内的两种情况,可以统一处理</p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-组内趣事" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/02/10/%E7%BB%84%E5%86%85%E8%B6%A3%E4%BA%8B/">组内趣事</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2023/02/10/%E7%BB%84%E5%86%85%E8%B6%A3%E4%BA%8B/" class="article-date">
  <time datetime="2023-02-10T06:26:44.290Z" itemprop="datePublished">2023-02-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="实习快乐语录"><a href="#实习快乐语录" class="headerlink" title="实习快乐语录"></a>实习快乐语录</h1><ol>
<li><p>z老师: 这originId谁加的，tmd，看不懂</p>
<p>…30s later</p>
<p>z老师: tmd, 我加的</p>
</li>
<li><p>z老师: za, 这, 这逻辑谁写的, 这么复杂</p>
<p>…30s later</p>
<p>z老师: 我写的</p>
<p>za: 现在只有上帝知道这些代码啥意思</p>
</li>
<li><p>组会开始前</p>
<p>某人: z老师昨天请假了?</p>
<p>z老师: 本来想今天也请假的, 但到了十几个快递, 来取快递</p>
<p>众人: 笑)</p>
</li>
<li><p>群里</p>
<p>某人: 这bug不好复现啊</p>
<p>主管: 偷偷标上已解决, 等测试下次复现再说</p>
</li>
</ol>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-一次http请求的过程" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/02/10/%E4%B8%80%E6%AC%A1http%E8%AF%B7%E6%B1%82%E7%9A%84%E8%BF%87%E7%A8%8B/">一次http请求的过程</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2023/02/10/%E4%B8%80%E6%AC%A1http%E8%AF%B7%E6%B1%82%E7%9A%84%E8%BF%87%E7%A8%8B/" class="article-date">
  <time datetime="2023-02-10T06:26:44.287Z" itemprop="datePublished">2023-02-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="一次http请求的过程"><a href="#一次http请求的过程" class="headerlink" title="一次http请求的过程"></a>一次http请求的过程</h1><ul>
<li>使用DNS域名解析</li>
<li>发起TCP的3次握手</li>
<li>建立TCP连接后发起<strong>http请求</strong>；</li>
<li>服务器响应<strong>http请求</strong>，浏览器得到返回response；</li>
</ul>
<h2 id="七层模型和五层模型"><a href="#七层模型和五层模型" class="headerlink" title="七层模型和五层模型"></a>七层模型和五层模型</h2><h3 id="七层模型"><a href="#七层模型" class="headerlink" title="七层模型"></a>七层模型</h3><p><img src="https://pic1.zhimg.com/v2-2d62ba265be486cb94ab531912aa3b9c_r.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/80/v2-436927a69a3574532059a78623d3095d_720w.webp" alt="img"></p>
<h2 id="使用DNS域名解析"><a href="#使用DNS域名解析" class="headerlink" title="使用DNS域名解析"></a>使用DNS域名解析</h2><p>使用域名的原因: 类比于用变量名代替地址, 使之有意义, 方便管理和记忆</p>
<h3 id="域名服务器的分级"><a href="#域名服务器的分级" class="headerlink" title="域名服务器的分级"></a>域名服务器的分级</h3><h4 id="ex-www-cs-android-com"><a href="#ex-www-cs-android-com" class="headerlink" title="ex: www.cs.android.com."></a>ex: <a target="_blank" rel="noopener" href="http://www.cs.android.com/">www.cs.android.com</a>.</h4><ul>
<li><p>.: 根域名</p>
</li>
<li><p>com: 顶级域名</p>
</li>
<li><p>android: 一级域名</p>
</li>
<li><p>cs: 二级域名</p>
</li>
<li><p>www: 主机名</p>
</li>
</ul>
<h3 id="解析的过程"><a href="#解析的过程" class="headerlink" title="解析的过程"></a>解析的过程</h3><ul>
<li><p>非递归服务器只用来查询下一级域名的 IP 地址，然后返回给发起查询的服务器, 由发起查询的服务器进行下一步操作</p>
</li>
<li><p>递归 DNS 服务器则把分步骤的查询过程自动化，方便用户一次性得到结果</p>
<p>它内部有缓存，可以保存以前查询的结果，下次再有人查询，就直接返回缓存里面的结果。所以它能加快查询，减轻源头 DNS 服务器的负担</p>
</li>
</ul>
<h2 id="TCP的3次握手和4次挥手"><a href="#TCP的3次握手和4次挥手" class="headerlink" title="TCP的3次握手和4次挥手"></a>TCP的3次握手和4次挥手</h2><h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3><h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>这个问题的本质是, 信道不可靠, 但是通信双发需要就某个问题达成一致. 而要解决这个问题, 无论你在消息中包含什么信息, 三次通信是理论上的最小值. 所以三次握手不是TCP本身的要求, 而是为了满足”在不可靠信道上可靠地传输信息”这一需求所导致的. </p>
<p>客户端和服务端通信前要进行连接，“3次握手”的作用就是<code>双方都能明确自己和对方的收、发能力是正常的</code>。</p>
<p><code>第一次握手</code>：客户端发送网络包，服务端收到了。这样服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的。</p>
<p><code>第二次握手</code>：服务端发包，客户端收到了。这样客户端就能得出结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的。 从客户端的视角来看，我接到了服务端发送过来的响应数据包，说明服务端接收到了我在第一次握手时发送的网络包，并且成功发送了响应数据包，这就说明，服务端的接收、发送能力正常。而另一方面，我收到了服务端的响应数据包，说明我第一次发送的网络包成功到达服务端，这样，我自己的发送和接收能力也是正常的。</p>
<p><code>第三次握手</code>：客户端发包，服务端收到了。这样服务端就能得出结论：客户端的接收、发送能力，服务端的发送、接收能力是正常的。 第一、二次握手后，服务端并不知道客户端的接收能力以及自己的发送能力是否正常。而在第三次握手时，服务端收到了客户端对第二次握手作的回应。从服务端的角度，我在第二次握手时的响应数据发送出去了，客户端接收到了。所以，我的发送能力是正常的。而客户端的接收能力也是正常的。</p>
<p>经历了上面的三次握手过程，客户端和服务端都确认了自己的接收、发送能力是正常的。之后就可以正常通信了。</p>
<p>打电话: </p>
<ol>
<li>A-&gt;B: 歪, 可以听到吗</li>
<li>B-&gt;A: 歪, 可以听到, 你可以听到吗</li>
<li>A-&gt;B: 歪, 我也可以听到 </li>
<li>开始交流</li>
</ol>
<h4 id="具体数据"><a href="#具体数据" class="headerlink" title="具体数据"></a>具体数据</h4><ol>
<li>刚开始客户端和服务端都是处于关闭的状态，而且服务端一直处于监听的状态，时刻监听是否有建立连接的请求；</li>
<li>当有客户端需要建立连接的时候就会发送一个确定连接的报文，此报文是同步报文SYN &#x3D; 1，并且会生成一个随机的序号 seq &#x3D; x，这是第一次握手；</li>
<li>当服务端接收到请求连接报文的时候，会发送一个同步报文确认报文，此报文 SYN &#x3D; 1，并且 ACK &#x3D; 1，同时服务端也会随机生成一个 seq &#x3D; y，并将 ack 设置成 x + 1，回传给客户端，这是第二次握手；</li>
<li>当客户端接收到服务端的 ACK 报文后，会回复一个 ACK 确认报文，用于确认确认报文已经收到，此报文 ACK &#x3D; 1，seq &#x3D; x + 1, ack &#x3D; y + 1，这是第三次握手；</li>
</ol>
<h3 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h3><h4 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h4><p>打电话: </p>
<ol>
<li>A-&gt;B: 我说完了, 我想挂了</li>
<li>B-&gt;A: 好的, 我知道了,你别说了,  等我说完</li>
<li>B-&gt;A: 好的, 我说完了, 可以挂了</li>
<li>A-&gt;B: 我知道了, 挂了</li>
<li>嘀嘀嘀~</li>
</ol>
<p>第一次挥手: 客户端发起关闭连接的请求给服务端；</p>
<p>第二次挥手: 服务端收到关闭请求的时候可能这个时候数据还没发送完，所以服务端会先回复一个确认报文，表示自己知道客户端想要关闭连接了，但是因为数据还没传输完，所以还需要等待；</p>
<p>第三次挥手: 当数据传输完了，服务端会主动发送一个 FIN 报文，告诉客户端，表示数据已经发送完了，服务端这边准备关闭连接了.</p>
<p>第四次挥手: 当客户端收到服务端的 FIN 报文过后，会回复一个 ACK 报文，告诉服务端自己知道了，再等待一会就关闭连接。</p>
<p>为什么握手要三次，挥手却要四次呢？</p>
<ul>
<li>那是因为握手的时候并没有数据传输，所以服务端的 SYN 和 ACK 报文可以一起发送，但是挥手的时候有数据在传输，所以 ACK 和 FIN 报文不能同时发送，需要分两步，所以会比握手多一步。</li>
</ul>
<h4 id="具体数据-1"><a href="#具体数据-1" class="headerlink" title="具体数据"></a>具体数据</h4><ol>
<li>客户端发起 FIN 断开连接的报文，携带随机生成的 seq 值 u，发送给服务端，并且自己处于 FIN-WSIT 状态，这是第一次挥手；</li>
<li>服务端接收到 FIN 报文后，回复一个确认报文，其中 ACK &#x3D; 1，随机生成一个 seq，以及 ack &#x3D; u + 1，这是第二次挥手；</li>
<li>当服务端数据发送完了过后，再发送一个 FIN 报文给客户端，通知客户端，服务端准备关闭连接了，此报文 FIN &#x3D; 1，ACK &#x3D; 1，ack &#x3D; u + 1，seq &#x3D; w，这是第三次挥手；</li>
<li>当客户端收到 FIN 确认报文时再发送一个FIN 的确认报文，其中 ACK &#x3D; 1，seq &#x3D; u + 1，ack &#x3D; w + 1，并进入 TIME-WAIT 状态，当等待 2MSL 后关闭连接，这是第四次挥手。</li>
</ol>
<h2 id="TCP和UDP的区别"><a href="#TCP和UDP的区别" class="headerlink" title="TCP和UDP的区别"></a>TCP和UDP的区别</h2><table>
<thead>
<tr>
<th align="left"></th>
<th align="left">UDP</th>
<th align="left">TCP</th>
</tr>
</thead>
<tbody><tr>
<td align="left">是否连接</td>
<td align="left">无连接</td>
<td align="left">面向连接</td>
</tr>
<tr>
<td align="left">是否可靠</td>
<td align="left">不可靠传输，不使用流量控制和拥塞控制</td>
<td align="left">可靠传输，使用流量控制和拥塞控制</td>
</tr>
<tr>
<td align="left">连接对象个数</td>
<td align="left">支持一对一，一对多，多对一和多对多交互通信</td>
<td align="left">只能是一对一通信</td>
</tr>
<tr>
<td align="left">传输方式</td>
<td align="left">面向报文</td>
<td align="left">面向字节流</td>
</tr>
<tr>
<td align="left">首部开销</td>
<td align="left">首部开销小，仅8字节</td>
<td align="left">首部最小20字节，最大60字节</td>
</tr>
<tr>
<td align="left">适用场景</td>
<td align="left">适用于实时应用（IP电话、视频会议、直播等）</td>
<td align="left">适用于要求可靠传输的应用，例如文件传输</td>
</tr>
</tbody></table>
<h2 id="路由协议有哪些"><a href="#路由协议有哪些" class="headerlink" title="路由协议有哪些"></a>路由协议有哪些</h2><h3 id="RIP"><a href="#RIP" class="headerlink" title="RIP"></a>RIP</h3><h3 id="OSPF"><a href="#OSPF" class="headerlink" title="OSPF"></a>OSPF</h3><h3 id="BGP"><a href="#BGP" class="headerlink" title="BGP"></a>BGP</h3><h2 id="Http协议概念"><a href="#Http协议概念" class="headerlink" title="Http协议概念"></a>Http协议概念</h2><h3 id="1-0"><a href="#1-0" class="headerlink" title="1.0"></a>1.0</h3><h3 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h3><h3 id="2-0"><a href="#2-0" class="headerlink" title="2.0"></a>2.0</h3><h3 id="3-0"><a href="#3-0" class="headerlink" title="3.0"></a>3.0</h3><h2 id="Socket的概念"><a href="#Socket的概念" class="headerlink" title="Socket的概念"></a>Socket的概念</h2><h2 id="WebSocket的概念"><a href="#WebSocket的概念" class="headerlink" title="WebSocket的概念"></a>WebSocket的概念</h2><h2 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h2><ol>
<li>实现了局域网内ip到mac的映射</li>
<li>不同局域网之间的主机通信, 使用host A—&gt;router,  …,  router—&gt;host B</li>
<li>通过发送广播实现, 信息为目的ip, 局域网内符合与之吻合的主机回应, 返回mac地址, 源主机做本地缓存</li>
</ol>
<h2 id="NAT协议"><a href="#NAT协议" class="headerlink" title="NAT协议"></a>NAT协议</h2><ol>
<li>实现了(公网ip, port) 到 (内网ip, port)的映射</li>
<li>目的是解决ipv4地址不足的问题</li>
</ol>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol>
<li>NAT 无法从外部向内部服务器建立连接</li>
<li>路由器应该只处理第3层功能</li>
<li>违背端到端通信原则</li>
</ol>
<h2 id="面向连接和面向无连接"><a href="#面向连接和面向无连接" class="headerlink" title="面向连接和面向无连接"></a>面向连接和面向无连接</h2><ul>
<li><p>无连接协议中的分组被称为数据报（datagram），每个分组都是独立寻址，并由应用程序发送的。从协议的角度来看，每个数据报都是一个独立的实体，与在两个相同的对等实体之间传送的任何其他数据报都没有关系</p>
</li>
<li><p>面向连接的协议则维护了分组之间的状态，使用这种协议的应用程序通常都会进行长期的对话。记住这些状态，协议就可以提供可靠的传输</p>
</li>
<li><p>典型的面向连接协议有三个阶段。第一阶段，在对等实体间<strong>建立连接</strong>。接下来是数据传输阶段，在这个阶段中，<strong>数据在对等实体间传输</strong>。最后，当对等实体完成数据传输时，<strong>连接被拆除</strong>。</p>
</li>
<li><p>一种标准的类比是：使用无连接协议就像寄信，而使用面向连接的协议就像打电话。</p>
</li>
</ul>
<h2 id="HTTP-状态码"><a href="#HTTP-状态码" class="headerlink" title="HTTP 状态码"></a>HTTP 状态码</h2><p>响应分为五类：信息响应(100–199)，成功响应(200–299)，重定向(300–399)，客户端错误(400–499)和服务器错误 (500–599)</p>
<table>
<thead>
<tr>
<th>100</th>
<th>Continue</th>
<th>继续。客户端应继续其请求</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>OK</td>
<td>请求成功。一般用于GET与POST请求</td>
</tr>
<tr>
<td>400</td>
<td>Bad Request</td>
<td>客户端请求的语法错误，服务器无法理解</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
<td>服务器理解请求客户端的请求，但是拒绝执行此请求</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>服务器无法根据客户端的请求找到资源（网页）</td>
</tr>
<tr>
<td>408</td>
<td>Request Time-out</td>
<td>服务器等待客户端发送的请求时间过长，超时</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
<td>服务器内部错误，无法完成请求</td>
</tr>
<tr>
<td>502</td>
<td>Bad Gateway</td>
<td>作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应</td>
</tr>
</tbody></table>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-事件分发机制" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/02/10/%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/">事件分发机制</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2023/02/10/%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/" class="article-date">
  <time datetime="2023-02-10T06:26:44.283Z" itemprop="datePublished">2023-02-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="事件分发机制"><a href="#事件分发机制" class="headerlink" title="事件分发机制"></a>事件分发机制</h1><h2 id="前文"><a href="#前文" class="headerlink" title="前文"></a>前文</h2><p>开发过程中遇到一个问题, 将xml的布局类型替换之后, 原先MagicIndicator正常的点击事件失效了</p>
<h2 id="尝试查看原理"><a href="#尝试查看原理" class="headerlink" title="尝试查看原理"></a>尝试查看原理</h2><ol>
<li><p>breakpoint 打到<code>ViewGroup</code>的<code> dispatchTransformedTouchEvent()</code>方法的 <code>handled = child.dispatchTouchEvent(event)</code> 这一行</p>
</li>
<li><p>在手指抬起前加入以上 breakpoint, 以方便查看<code>ACTION_UP</code>事件</p>
</li>
<li><p>多次递归, 进入最后一层递归<code>RecyclerView</code>的<code> dispatchTouchEvent()</code> 方法</p>
</li>
<li><p>进入 <code>handled = dispatchTransformedTouchEvent(ev,canceled,null,TouchTarget.ALL_POINTER_IDS);</code>方法</p>
</li>
<li><p>上一条中方法第三个参数为null, 查看原因</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * mFirstTouchTarget 为 null, 故传入null (这是传入null的直接原因)</span></span><br><span class="line"><span class="comment"> * 在else语句中, while循环遍历 mFirstTouchTarget 链表, 最后mFirstTouchTarget也为null</span></span><br><span class="line"><span class="comment"> * 即, 此if语句之后, mFirstTouchTarget 必为null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span> (mFirstTouchTarget == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// No touch targets so treat this as an ordinary view.</span></span><br><span class="line">    handled = dispatchTransformedTouchEvent(ev, canceled, <span class="literal">null</span>,</span><br><span class="line">            TouchTarget.ALL_POINTER_IDS);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Dispatch to touch targets, excluding the new touch target if we already</span></span><br><span class="line">    <span class="comment">// dispatched to it.  Cancel touch targets if necessary.</span></span><br><span class="line">    <span class="type">TouchTarget</span> <span class="variable">predecessor</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">TouchTarget</span> <span class="variable">target</span> <span class="operator">=</span> mFirstTouchTarget;</span><br><span class="line">    <span class="keyword">while</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TouchTarget</span> <span class="variable">next</span> <span class="operator">=</span> target.next;</span><br><span class="line">        <span class="keyword">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</span><br><span class="line">            handled = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">cancelChild</span> <span class="operator">=</span> resetCancelNextUpFlag(target.child)</span><br><span class="line">                    || intercepted;</span><br><span class="line">            <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</span><br><span class="line">                    target.child, target.pointerIdBits)) &#123;</span><br><span class="line">                handled = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (cancelChild) &#123;</span><br><span class="line">                <span class="keyword">if</span> (predecessor == <span class="literal">null</span>) &#123;</span><br><span class="line">                    mFirstTouchTarget = next;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    predecessor.next = next;</span><br><span class="line">                &#125;</span><br><span class="line">                target.recycle();</span><br><span class="line">                target = next;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        predecessor = target;</span><br><span class="line">        target = next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>这里引出对<code>TouchTarget</code>的关注, 见下文的TouchTarget标题</p>
</li>
<li><p><code>mFirstTouchTarget</code>为空的原因为<code>dispatchTransformedTouchEvent</code>()分发<code>ACTION_DOWN</code>事件未被消费, 导致<code>addTouchTarget()</code>未被调用过</p>
</li>
<li><p>因此, 需查看<code>ACTION_DOWN</code>事件未被消费的原因</p>
</li>
<li><p>上面扯远了, 自己研究源码没整明白, 向leader询问, 这里回归点击事件被吞掉的原因</p>
</li>
<li><p>原先的ViewGroup是LinearLayout, 改成了ConstraintLayout, 而且下方的RecyclerView设置相对位置错误, 导致和上面的MagicIndicator重叠了, 而且RecyclerView设置了android:paddingTop&#x3D;”20dp”, 导致了问题</p>
</li>
<li></li>
</ol>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 原先代码为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">net.lucode.hackware.magicindicator.MagicIndicator</span></span></span><br><span class="line"><span class="tag"> 		<span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span>    </span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.airbnb.epoxy.EpoxyRecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:paddingTop</span>=<span class="string">&quot;20dp&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 修改后bug代码为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">net.lucode.hackware.magicindicator.MagicIndicator</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:id</span>=<span class="string">&quot;@+id/container&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag"> 		<span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag"> 		<span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag"> 		<span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">com.airbnb.epoxy.EpoxyRecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:paddingTop</span>=<span class="string">&quot;20dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/container&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="TouchTarget"><a href="#TouchTarget" class="headerlink" title="TouchTarget"></a>TouchTarget</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TouchTarget</span> &#123;</span><br><span class="line">    <span class="comment">// The touched child view.</span></span><br><span class="line">    <span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">    <span class="keyword">public</span> View child;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The combined bit mask of pointer ids for all pointers captured by the target.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> pointerIdBits;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The next target in the target list.</span></span><br><span class="line">    <span class="keyword">public</span> TouchTarget next;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@UnsupportedAppUsage</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">TouchTarget</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TouchTarget <span class="title function_">obtain</span><span class="params">(<span class="meta">@NonNull</span> View child, <span class="type">int</span> pointerIdBits)</span> &#123;</span><br><span class="line">  		<span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recycle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此类是消费了<code>ACTION_DOWN</code>事件的view的集合, 方便了后续的<code>ACTION_MOVE</code>和<code>ACTION_UP</code>事件的处理, 即, 不需要重新遍历整个view树, 只需要遍历TouchTarget链表</p>
<h2 id="为解决该问题学到事件分发的基本流程"><a href="#为解决该问题学到事件分发的基本流程" class="headerlink" title="为解决该问题学到事件分发的基本流程"></a>为解决该问题学到事件分发的基本流程</h2><p>1.<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从Activity的dispatchTouchEvent()开始分析</span></span><br><span class="line"><span class="comment"> * 先判断是否是ACTION_DOWN事件, 对于ACTION_DOWN有特殊处理, 这里不讨论</span></span><br><span class="line"><span class="comment"> * 然后调用了Window类的子类PhoneWindow的superDispatchTouchEvent()方法</span></span><br><span class="line"><span class="comment"> * PhoneWindow的superDispatchTouchEvent()直接调用了DecorView的superDispatchTouchEvent()</span></span><br><span class="line"><span class="comment"> * 调用了ViewGroup的dispatchTouchEvent()方法</span></span><br><span class="line"><span class="comment"> * 如果ViewGroup#dispatchTouchEvent()返回true, Activity的事件分发流程结束</span></span><br><span class="line"><span class="comment"> * 否则, 进入onTouchEvent()方法, 这里不讨论</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        onUserInteraction();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (getWindow().superDispatchTouchEvent(ev)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> onTouchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * viewGroup的事件分发</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">   	<span class="comment">//...</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">handled</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (onFilterTouchEventForSecurity(ev)) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">action</span> <span class="operator">=</span> ev.getAction();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">actionMasked</span> <span class="operator">=</span> action &amp; MotionEvent.ACTION_MASK;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> intercepted;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 这里对ACTION_DOWN事件和其他事件做了区分, 因为ACTION_DOWN是第一个传递到各个view的事件</span></span><br><span class="line"><span class="comment">         * view响应了ACTION_DOWN事件后, 会被加入mFirstTouchTarget链表中, 方便在响应</span></span><br><span class="line"><span class="comment">         * ACTION_MOVE和ACTION_UP事件时, 不需要遍历整个view树, 只需要到链表找查找即可, 提高效率</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         * 如果不是ACTION_DOWN事件, 且mFirstTouchTarget链表为空, 表示下层view都不能处理</span></span><br><span class="line"><span class="comment">         * 该事件, 需要判断为拦截, 不进行下发</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="comment">//如果允许拦截,intercepted变量标志着事件是否被拦截</span></span><br><span class="line">            <span class="keyword">if</span> (!disallowIntercept) &#123;</span><br><span class="line">                intercepted = onInterceptTouchEvent(ev);</span><br><span class="line">                ev.setAction(action); <span class="comment">// restore action in case it was changed</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                intercepted = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// There are no touch targets and this action is not an initial down</span></span><br><span class="line">            <span class="comment">// so this view group continues to intercept touches.</span></span><br><span class="line">            intercepted = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 如果事件没有取消且未拦截, 开始事件分发</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (!canceled &amp;&amp; !intercepted) &#123;</span><br><span class="line">		   <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                    || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</span><br><span class="line">                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">               </span><br><span class="line">               		<span class="comment">/**</span></span><br><span class="line"><span class="comment">               		 * for循环遍历此viewGroup的全部children_view</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    				<span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * canReceivePointerEvents()判断此view是否能响应点击事件</span></span><br><span class="line"><span class="comment">                     * isTransformedTouchPointInView()方法判断点击位置是否在view内</span></span><br><span class="line"><span class="comment">                     * 都满足则分发事件</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                        <span class="keyword">if</span> (!child.canReceivePointerEvents()</span><br><span class="line">                            || !isTransformedTouchPointInView(x, y, child, <span class="literal">null</span>)) &#123;</span><br><span class="line">                          </span><br><span class="line">                            ev.setTargetAccessibilityFocus(<span class="literal">false</span>);</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">/**</span></span><br><span class="line"><span class="comment">                         * dispatchTransformedTouchEvent()向下分发事件</span></span><br><span class="line"><span class="comment">                         * 如果返回ture, 说明事件被处理, 调用了break退出循环</span></span><br><span class="line"><span class="comment">                         * </span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">                        <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="literal">false</span>, child,idBitsToAssign)) &#123;</span><br><span class="line">            				<span class="comment">//...</span></span><br><span class="line">                            mLastTouchDownX = ev.getX();</span><br><span class="line">                            mLastTouchDownY = ev.getY();</span><br><span class="line">                            newTouchTarget = addTouchTarget(child, idBitsToAssign);</span><br><span class="line">                            alreadyDispatchedToNewTouchTarget = <span class="literal">true</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (preorderedList != <span class="literal">null</span>) preorderedList.clear();</span><br><span class="line">                &#125;</span><br><span class="line">            	<span class="comment">//...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * mFirstTouchTarget == null表示下次view都不能处理此事件</span></span><br><span class="line"><span class="comment">         * 这里会调用到 super.dispatchTouchEvent(event) </span></span><br><span class="line"><span class="comment">         * 也就是view的dispatchTouchEvent(event)</span></span><br><span class="line"><span class="comment">         * 在里面判断了是否设置了监听器, 如果没有, 认为不能处理该事件, 返回false, 交由上层处理</span></span><br><span class="line"><span class="comment">         * 否则, 返回了true, 表示处理完成</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (mFirstTouchTarget == <span class="literal">null</span>) &#123;</span><br><span class="line">            handled = dispatchTransformedTouchEvent(ev, canceled, <span class="literal">null</span>,</span><br><span class="line">                    TouchTarget.ALL_POINTER_IDS);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 如果mFirstTouchTarget不为空, 表示下次有view能处理该事件</span></span><br><span class="line"><span class="comment">             * 通过链表结构, 下发事件</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="type">TouchTarget</span> <span class="variable">predecessor</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">TouchTarget</span> <span class="variable">target</span> <span class="operator">=</span> mFirstTouchTarget;</span><br><span class="line">            <span class="keyword">while</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">TouchTarget</span> <span class="variable">next</span> <span class="operator">=</span> target.next;</span><br><span class="line">                <span class="keyword">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</span><br><span class="line">                    handled = <span class="literal">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">cancelChild</span> <span class="operator">=</span> resetCancelNextUpFlag(target.child)</span><br><span class="line">                            || intercepted;</span><br><span class="line">                    <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</span><br><span class="line">                            target.child, target.pointerIdBits)) &#123;</span><br><span class="line">                        handled = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (cancelChild) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (predecessor == <span class="literal">null</span>) &#123;</span><br><span class="line">                            mFirstTouchTarget = next;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            predecessor.next = next;</span><br><span class="line">                        &#125;</span><br><span class="line">                        target.recycle();</span><br><span class="line">                        target = next;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                predecessor = target;</span><br><span class="line">                target = next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">    <span class="keyword">return</span> handled;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li></li>
</ol>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//<span class="doctag">TODO:</span> View的事件分发和onTouchEvent()方法的分析</span></span><br></pre></td></tr></table></figure>

<h2 id="发现一个好文章"><a href="#发现一个好文章" class="headerlink" title="发现一个好文章"></a>发现一个好文章</h2><p>记录在此<a target="_blank" rel="noopener" href="https://gist.github.com/jp1017/0e5dede13737c85754f8">https://gist.github.com/jp1017/0e5dede13737c85754f8</a></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-设计模式---面向对象六大原则" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/02/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F---%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99/">设计模式---面向对象六大原则</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2023/02/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F---%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99/" class="article-date">
  <time datetime="2023-02-10T06:26:44.279Z" itemprop="datePublished">2023-02-10</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="设计模式—面向对象六大原则"><a href="#设计模式—面向对象六大原则" class="headerlink" title="设计模式—面向对象六大原则"></a>设计模式—面向对象六大原则</h1><h2 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h2><h2 id="开闭原则"><a href="#开闭原则" class="headerlink" title="开闭原则"></a>开闭原则</h2><h2 id="里氏替换"><a href="#里氏替换" class="headerlink" title="里氏替换"></a>里氏替换</h2><p>里氏代换原则是实现开闭原则的重要方式之一，由于使用基类对象的地方都可以使用子类对象，因此在程序中尽量使用基类类型来对对象进行定义，而在运行时再确定其子类类型，用子类对象来替换父类对象。</p>
<p>在程序中尽量使用基类类型来对对象进行定义，而在运行时再确定其子类类型，用子类对象来替换父类对象</p>
<p>感觉是这个意思吧，父类已经实现的方便，子类尽量不要去重写，子类可以去实现父类里没有实现的方法？</p>
<p>重写虚方法才会有多态，重写非虚方法对于面向接口编程意义不大，所以理解里氏原则，得以面向接口编程作思考…</p>
<p>JAVA中，多态是不是违背了里氏替换原则？？ 里氏替换原则要求子类避免重写父类方法，而多态的条件之一却是要求子类重写父类的方法。所以，我搞不懂里氏替换原则与继承，多态之间的关系。求大神解答，初学小弟跪拜。</p>
<p>LSP的原定义比较复杂，我们一般对里氏替换原则 LSP的解释为：子类对象能够替换父类对象，而程序逻辑不变。里氏替换原则有至少以下两种含义：</p>
<p>里氏替换原则是针对继承而言的，如果继承是为了实现代码重用，也就是为了共享方法，那么共享的父类方法就应该保持不变，不能被子类重新定义。子类只能通过新添加方法来扩展功能，父类和子类都可以实例化，而子类继承的方法和父类是一样的，父类调用方法的地方，子类也可以调用同一个继承得来的，逻辑和父类一致的方法，这时用子类对象将父类对象替换掉时，当然逻辑一致，相安无事。 如果继承的目的是为了多态，而多态的前提就是子类覆盖并重新定义父类的方法，为了符合LSP，我们应该将父类定义为抽象类，并定义抽象方法，让子类重新定义这些方法，当父类是抽象类时，父类就是不能实例化，所以也不存在可实例化的父类对象在程序里。也就不存在子类替换父类实例（根本不存在父类实例了）时逻辑不一致的可能。 不符合LSP的最常见的情况是，父类和子类都是可实例化的非抽象类，且父类的方法被子类重新定义，这一类的实现继承会造成父类和子类间的强耦合，也就是实际上并不相关的属性和方法牵强附会在一起，不利于程序扩展和维护。</p>
<p>如何符合LSP？总结一句话 —— 就是尽量不要从可实例化的父类中继承，而是要使用基于抽象类和接口的继承。</p>
<p>说的很透彻了。说白了，就是大家都基于抽象去编程，而不要基于具体。这样也就可以实现：对扩展（基于抽象）是开放的，对变更（基于具体）是禁止的。</p>
<p>里氏转换原则要求子类从抽象继承而不是从具体继承，如果从抽象继承，子类必然要重写父类方法。因此里氏转换原则和多态是相辅相成的！至于你说的第一条没有听说过。</p>
<p>刚才看了几篇文章，作者说的是，里氏转换原则要避免重写父类的非抽象方法，而多态的实现是通过重写抽象方法实现的，所以并不冲突。</p>
<p>不违反里氏替换的多态：重写父类的抽象方法</p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-八皇后问题" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/10/25/%E5%85%AB%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98/">eight queens</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2022/10/25/%E5%85%AB%E7%9A%87%E5%90%8E%E9%97%AE%E9%A2%98/" class="article-date">
  <time datetime="2022-10-25T07:30:16.000Z" itemprop="datePublished">2022-10-25</time>
</a>
    
    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="八皇后问题"><a href="#八皇后问题" class="headerlink" title="八皇后问题"></a>八皇后问题</h1><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>在8×8格的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%9B%BD%E9%99%85%E8%B1%A1%E6%A3%8B/80888?fromModule=lemma_inlink">国际象棋</a>上摆放8个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%9A%87%E5%90%8E/15860305?fromModule=lemma_inlink">皇后</a>，使其不能互相攻击，即任意两个皇后都不能处于同一行、同一列或同一<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%96%9C%E7%BA%BF/8546925?fromModule=lemma_inlink">斜线</a>上，问有多少种摆法。</p>
<h3 id="实现如下"><a href="#实现如下" class="headerlink" title="实现如下"></a>实现如下</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> arr[<span class="number">10</span>][<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> checkColumn[<span class="number">10</span>], checkL2R[<span class="number">20</span>], checkR2L[<span class="number">20</span>];</span><br><span class="line"><span class="type">int</span> js = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> arr[<span class="number">10</span>][<span class="number">10</span>], <span class="type">int</span> row)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">dfs</span>(arr, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> arr[<span class="number">10</span>][<span class="number">10</span>], <span class="type">int</span> row)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (row == <span class="number">9</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;*******&quot;</span> &lt;&lt; js &lt;&lt; <span class="string">&quot;*******&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">8</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= <span class="number">8</span>; ++j) &#123;</span><br><span class="line">                cout &lt;&lt; arr[i][j] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cout &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;****************&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">        js++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">8</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!checkColumn[i] &amp;&amp; !checkL2R[i - row + <span class="number">10</span>] &amp;&amp; !checkR2L[i + row]) &#123;</span><br><span class="line">            checkColumn[i] = <span class="number">1</span>;</span><br><span class="line">            checkL2R[i - row + <span class="number">10</span>] = <span class="number">1</span>;</span><br><span class="line">            checkR2L[i + row] = <span class="number">1</span>;</span><br><span class="line">            arr[row][i] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">dfs</span>(arr, row + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            arr[row][i] = <span class="number">0</span>;</span><br><span class="line">            checkColumn[i] = <span class="number">0</span>;</span><br><span class="line">            checkL2R[i - row + <span class="number">10</span>] = <span class="number">0</span>;</span><br><span class="line">            checkR2L[i + row] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>
  
  
</article>

  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &amp;raquo;</a>
  </nav>


</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/default-avatar.jpg" title="图片来自网络"></img>
    <h3 class="avatar-name">
      
        安安
      
    </h3>
    <p class="avatar-slogan">
      正在摸鱼的安卓实习生
    </p>
  </div>
</div>


  
    

  
    

  
    
  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/04/20/TodoList/">TodoList by An</a>
          </li>
        
          <li>
            <a href="/2023/04/20/T458%E6%9D%80%E7%8C%AA/">458. 可怜的小猪(杀猪)</a>
          </li>
        
          <li>
            <a href="/2023/04/20/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%92%8CRSA%E7%AE%97%E6%B3%95/">非对称加密和RSA算法</a>
          </li>
        
          <li>
            <a href="/2023/04/18/T07_08/">T07_08 面试题 08.07. 无重复字符串的排列组合</a>
          </li>
        
          <li>
            <a href="/2023/04/17/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2023 John Doe &nbsp;&nbsp;
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;主题 <a target="_blank" rel="noopener" href="https://github.com/yiluyanxia/hexo-theme-antiquity">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">不蒜子告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>

  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>